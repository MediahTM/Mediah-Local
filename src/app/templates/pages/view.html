{% extends "layout.html" %}

{% block content %}
    <div class="px-4">
        <div class="mx-auto container w-full">
            <div id="FileDetailsContainer" class="my-12 h-full">
                <div class="h-full flex items-center justify-center my-12">
                    <div class="w-10 h-10 rounded-full border border-2 border-zinc-700 border-r-white animate-spin"></div>
                </div>
            </div>
        </div>
        <script>
            const FileDetailsContainer = $("#FileDetailsContainer"); 
            const url = location.search.split("?url=")[1].split("&")[0];
            const type = location.search.split("&type=")[1];
            const base_url = "https://raw.githubusercontent.com/MediahTM/Mediah-Downloads/main/downloads/";

            function formatTime(minutes) {
                if (typeof minutes !== 'number' || isNaN(minutes)) {
                    return "Invalid input, create a GitHub issue!";
                }
                const hours = Math.floor(minutes / 60) + "h";
                var remainingMinutes = minutes % 60 + "m";
                return `${hours} ${remainingMinutes}`;
            }

            switch(type) {
                case "film": {
                    $.get({
                        url: `${base_url}${url}`,
                        success: (index) => {
                            index = JSON.parse(index)
                            $.get({
                                url: `https://api.themoviedb.org/3/movie/${index.tmdb}?api_key={{tmdb_apikey}}`,
                                success: (data) => {
                                    console.log(data)
                                    $.get({
                                        url: `https://api.themoviedb.org/3/movie/${index.tmdb}/keywords?api_key={{tmdb_apikey}}`,
                                        success: (keywords) => {
                                            $.get({
                                                url: `https://api.themoviedb.org/3/movie/${index.tmdb}/credits?api_key={{tmdb_apikey}}`,
                                                success: (actors) => {
                                                    console.log(actors)
                                                    FileDetailsContainer.html(``);
                                                    FileDetailsContainer.append(`{% include "parts/FilmView.html" %}`)
                                                },
                                                error: (error) => {
                                                    alert(`Ran in to an issue fetching the tmdb credits data, create a GitHub issue!`)
                                                }
                                            })
                                        },
                                        error: (error) => {
                                            alert(`Ran in to an issue fetching the tmdb keyword data, create a GitHub issue!`)
                                        }
                                    })
                                },
                                error: (error) => {
                                    alert(`Ran in to an issue fetching the tmdb data, create a GitHub issue!`)
                                }
                            })
                        },
                        error: (error) => {
                            alert(`Ran in to an issue fetching the film json data, create a GitHub issue!`)
                        }
                    })
                }
            }
        </script>
    </div>
{% endblock %}